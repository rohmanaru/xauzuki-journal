<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Laporan Kinerja - Xauzuki</title>

<style>
:root{
  --bg:#0f172a;
  --card:#111827;
  --border:#1f2937;
  --text:#e5e7eb;
  --muted:#9ca3af;
  --green:#22c55e;
  --gray:#9ca3af;
  --blue:#3b82f6;
}

*{box-sizing:border-box}

body{
  margin:0;
  padding:1rem;
  background:var(--bg);
  color:var(--text);
  font-family:Segoe UI,Tahoma,sans-serif;
  font-size:13px;
}

.container{max-width:900px;margin:auto}

/* HEADER */
.header{
  display:flex;
  align-items:center;
  gap:.6rem;
  margin-bottom:.6rem;
}
.back{
  cursor:pointer;
  color:var(--blue);
  font-size:.8rem;
}

/* TABS */
.tabs{
  display:flex;
  gap:.4rem;
  margin-bottom:.6rem;
}
.tab{
  flex:1;
  text-align:center;
  padding:.4rem;
  border:1px solid var(--border);
  border-radius:6px;
  cursor:pointer;
  color:var(--muted);
}
.tab.active{
  background:var(--card);
  color:var(--text);
  border-color:var(--blue);
}

/* TABLE */
.table{
  background:var(--card);
  border:1px solid var(--border);
  border-radius:8px;
  overflow:hidden;
}
.row{
  display:grid;
  grid-template-columns:    
    0.6fr   /* Hari (lebih kecil) */
    1.1fr   /* Tanggal */
    1fr   /* Jenis */
    1.3fr   /* USc (lebih lebar) */
    0.8fr;  /* USD (lebih kecil) */
  padding:.45rem .5rem;
  border-bottom:1px solid var(--border);
  font-size:.75rem;
}
.row.header{
  color:var(--muted);
  font-weight:600;
}
.row:last-child{border-bottom:none}

.green{color:var(--green)}
.gray{color:var(--gray)}

.empty{
  text-align:center;
  padding:1rem;
  color:var(--muted);
}
.report-title{
  text-align:center;
  font-size:1rem;
  font-weight:600;
  background:var(--card);
  border:1px solid var(--border);
  border-radius:8px;
  padding:.6rem;
  margin-bottom:.6rem;
}
.row.header{
  background:#0b1220;
  color:var(--muted);
  font-weight:600;
}
.filters{
  display:flex;
  gap:.4rem;
  justify-content:center;
  margin-bottom:.6rem;
}

.filters button{
  background:var(--card);
  border:1px solid var(--border);
  color:var(--muted);
  padding:.3rem .6rem;
  border-radius:6px;
  font-size:.7rem;
  cursor:pointer;
}

.filters button.active{
  border-color:var(--blue);
  color:var(--text);
}
.chart-box{
  margin-top:1rem;
  background:var(--card);
  border:1px solid var(--border);
  border-radius:8px;
  padding:.6rem;
}
.footer{
  margin-top:1.2rem;
  padding:.6rem 0;
  text-align:center;
  font-size:.65rem;
  color:var(--muted);
  border-top:1px solid var(--border);
}

</style>
</head>

<body>
<div class="container">

<div class="header">
  <div class="back" onclick="back()">← Kembali</div>
</div>

<div class="report-title">
  Laporan Kinerja
</div>


<!-- TABS -->
<div class="tabs">
  <div class="tab active" onclick="setMode('all')">Semua</div>
  <div class="tab" onclick="setMode('profit')">Profit</div>
  <div class="tab" onclick="setMode('withdraw')">Withdraw</div>
</div>

<div class="filters">
  <button class="active" onclick="setAll()">All Time</button>
  <button onclick="setRange(7)">7 Hari</button>
  <button onclick="setRange(30)">1 Bulan</button>
  <button onclick="setRange(90)">3 Bulan</button>
  <button onclick="openCustom()">Custom</button>
</div>

<div id="custom-range" style="display:none;margin-bottom:.6rem;text-align:center">
  <input type="date" id="from">
  <input type="date" id="to">
  <button onclick="applyCustom()">Terapkan</button>
</div>

<!-- TABLE -->
<div class="table">
  <div class="row header">
    <div>Hari</div>
    <div>Tanggal</div>
    <div>Jenis</div>
    <div>USc</div>
    <div>USD</div>
  </div>
  <div id="rows"></div>
</div>
 <br><br><br>
<div class="chart-box">
  <canvas id="chart"></canvas>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

</div>

<script>
let mode="all";
let rangeDays = null;     // 7, 30, 90
let customFrom = null;   // yyyy-mm-dd
let customTo = null;     // yyyy-mm-dd
let chartInstance = null;

function back(){
  window.location.href="index.html";
}

function getEvents(){
  return JSON.parse(localStorage.getItem("JurnalX-Events")||"[]");
}

function formatDate(d){
  const [y,m,day] = d.split("-");
  return `${day.padStart(2,"0")}-${m.padStart(2,"0")}-${y}`;
}
function clearFilterUI(btn){
  document.querySelectorAll(".filters button")
    .forEach(b=>b.classList.remove("active"));
  if(btn) btn.classList.add("active");
}

function setAll(){
  rangeDays = null;
  customFrom = customTo = null;
  document.getElementById("custom-range").style.display = "none";
  clearFilterUI(event.target);
  render();
}

function setRange(days){
  rangeDays = days;
  customFrom = customTo = null;
  document.getElementById("custom-range").style.display = "none";
  clearFilterUI(event.target);
  render();
}

function openCustom(){
  rangeDays = null;
  clearFilterUI(event.target);
  document.getElementById("custom-range").style.display = "block";
}

function applyCustom(){
  customFrom = document.getElementById("from").value;
  customTo   = document.getElementById("to").value;
  render();
}

function renderChart(events){
  const ctx = document.getElementById("chart");
  if(!ctx) return;

  if(chartInstance){
    chartInstance.destroy();
  }

  let labels = [];
  let values = [];

  let equity = 0;

  events.forEach(e=>{
    labels.push(formatDate(e.date));

    if(mode === "withdraw"){
      values.push(e.usc);
    }
    else if(mode === "profit"){
      equity += (e.type === "profit" ? e.usc : 0);
      values.push(equity);
    }
    else{
      equity += (e.type === "profit" ? e.usc : -e.usc);
      values.push(equity);
    }
  });

  const color =
    mode === "profit"   ? "#22c55e" :
    mode === "withdraw" ? "#9ca3af" :
                          "#3b82f6";

  chartInstance = new Chart(ctx, {
    type: "line",
    data: {
      labels: labels,
      datasets: [{
        data: values,
        borderColor: color,
        backgroundColor: "transparent",
        tension: 0.35,
        pointRadius: 3,
        pointBackgroundColor: color
      }]
    },
    options: {
      responsive: true,
      plugins: {
        legend: { display: false }
      },
      scales: {
        x: {
          ticks: { color: "#9ca3af" },
          grid:  { color: "rgba(255,255,255,0.05)" }
        },
        y: {
          ticks: { color: "#9ca3af" },
          grid:  { color: "rgba(255,255,255,0.05)" }
        }
      }
    }
  });
}

function setMode(m){
  mode=m;
  document.querySelectorAll(".tab").forEach(t=>t.classList.remove("active"));
  event.target.classList.add("active");
  render();
}

function render(){
  const cont=document.getElementById("rows");
  cont.innerHTML="";
  let events=getEvents();
  const now = new Date();

events = events.filter(e => {
  const d = new Date(e.date);

  // FILTER RANGE (7 / 30 / 90)
  if (rangeDays) {
    const diff = (now - d) / (1000 * 60 * 60 * 24);
    return diff <= rangeDays;
  }

  // FILTER CUSTOM
  if (customFrom && customTo) {
    return d >= new Date(customFrom) && d <= new Date(customTo);
  }

  // SEMUA
  return true;
});


  if(mode!=="all"){
    events=events.filter(e=>e.type===mode);
  }

  if(events.length===0){
    cont.innerHTML=`<div class="empty">Belum ada data</div>`;
    return;
  }

  events.forEach(e=>{
    const isProfit=e.type==="profit";
    cont.innerHTML+=`
      <div class="row">
        <div>${e.day}</div>
        <div>${formatDate(e.date)}</div>
        <div>${isProfit?"Profit":"Withdraw"}</div>
        <div class="${isProfit?"green":"gray"}">
          ${isProfit?"+":"-"}${e.usc.toFixed(2)}
        </div>
        <div class="${isProfit?"green":"gray"}">
          ${isProfit?"+":"-"}$${(e.usc/100).toFixed(2)}
        </div>
      </div>
    `;
  });
  renderChart(events);

}


render();

</script>
<footer class="footer">
  Copyright © 2026 Xauzuki Journal • by rohmanaru_
  <br>
  All Rights Reserved
</footer>

</body>
</html>
